<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <link rel="stylesheet" href="./style.css" />
  <link rel="shortcut icon" href="http://mkweb.bcgsc.ca/genomeinfo2010/gfx/favicon.ico" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="generator" content="manually!" />
  <meta name="keywords" content="genome informatics 2010, cshl, hinxton, conference, program, cover, inforgraphics, genome, path" />
  <meta name="author" content="Martin Krzywinski" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" integrity="sha256-V8SV2MO1FUb63Bwht5Wx9x6PVHNa02gv8BgH/uH3ung=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" integrity="sha256-dsOXGNHAo/syFnazt+KTBsCQeRmlcW1XKL0bCK4Baec=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js" integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js" integrity="sha256-90d2pnfw0r4K8CZAWPko4rpFXQsZvJhTBGYNkipDprI=" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css?family=EB+Garamond|PT+Serif|Roboto+Mono|Vollkorn&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/cpp.min.js" integrity="sha256-ozgG+omJySLxpb4zh+eKHe0tNrz5t+a5j1sK8f3V8UY=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/sunburst.min.css" integrity="sha256-Gzd23jxV5GcW9yoFsMduPm18uqn9RGwxHgcg6zs2H1U=" crossorigin="anonymous" />
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/night-owl.min.css" integrity="sha256-K8fTxESt4HMQY0HnseJ1Wt1rDO8oJZkTUT22tdVg5Po=" crossorigin="anonymous" /> -->
  <meta name="copyright" content="copyright (c) 2010 Martin Krzywinski" />
  <title>Interpolating in a Triangle</title>
  <script>
    $(document).ready(function() {
      renderMathInElement(document.body);
      hljs.initHighlightingOnLoad();

      var update_with_bary = function(x, y) {

        var p = document.getElementById("tri-interp-m2-p");
        var l1 = document.getElementById("tri-interp-m2-l1");
        var l2 = document.getElementById("tri-interp-m2-l2");
        var l3 = document.getElementById("tri-interp-m2-l3");
        var w1 = document.getElementById("tri-interp-m2-w1");
        var w2 = document.getElementById("tri-interp-m2-w2");
        var w3 = document.getElementById("tri-interp-m2-w3");

        var weights = calc_barycentric_weights(x, y, 150, 50, 50, 250, 250, 250);
        if (weights[0] < 0 || weights[1] < 0 || weights[2] < 0) return;

        p.setAttribute("cx", x);
        p.setAttribute("cy", y);

        var w_v1 = weights[0];
        var w_v2 = weights[1];
        var w_v3 = weights[2];

        l1.setAttribute("x2", x);
        l2.setAttribute("x2", x);
        l3.setAttribute("x2", x);
        l1.setAttribute("y2", y);
        l2.setAttribute("y2", y);
        l3.setAttribute("y2", y);

        l1.style['stroke-width'] = (w_v1 * 5) + 1 + "px";
        l2.style['stroke-width'] = (w_v2 * 5) + 1 + "px";
        l3.style['stroke-width'] = (w_v3 * 5) + 1 + "px";

        w1.textContent = Math.round(w_v1 * 100) + "%";
        w2.textContent = Math.round(w_v2 * 100) + "%";
        w3.textContent = Math.round(w_v3 * 100) + "%";
      };

      document.getElementById("tri-interp-m2").addEventListener("mousemove", function(e) {
        var x = e.clientX - e.currentTarget.getBoundingClientRect().left;
        var y = e.clientY - e.currentTarget.getBoundingClientRect().top;

        update_with_bary(x, y);
      });


      update_with_bary(150, 150);

      /***/

      var update_with_naive = function(x, y) {
        var p = document.getElementById("tri-interp-m1-p");
        var l1 = document.getElementById("tri-interp-m1-l1");
        var l2 = document.getElementById("tri-interp-m1-l2");
        var l3 = document.getElementById("tri-interp-m1-l3");
        var w1 = document.getElementById("tri-interp-m1-w1");
        var w2 = document.getElementById("tri-interp-m1-w2");
        var w3 = document.getElementById("tri-interp-m1-w3");

        var weights = calc_barycentric_weights(x, y, 150, 50, 50, 250, 250, 250);
        if (weights[0] < 0 || weights[1] < 0 || weights[2] < 0) return;

        p.setAttribute("cx", x);
        p.setAttribute("cy", y);

        weights = calc_naive_weights(x, y, 150, 50, 50, 250, 250, 250);

        var w_v1 = weights[0];
        var w_v2 = weights[1];
        var w_v3 = weights[2];

        l1.setAttribute("x2", x);
        l2.setAttribute("x2", x);
        l3.setAttribute("x2", x);
        l1.setAttribute("y2", y);
        l2.setAttribute("y2", y);
        l3.setAttribute("y2", y);

        l1.style['stroke-width'] = (w_v1 * 5) + 1 + "px";
        l2.style['stroke-width'] = (w_v2 * 5) + 1 + "px";
        l3.style['stroke-width'] = (w_v3 * 5) + 1 + "px";

        w1.textContent = Math.round(w_v1 * 100) + "%";
        w2.textContent = Math.round(w_v2 * 100) + "%";
        w3.textContent = Math.round(w_v3 * 100) + "%";
      };

      document.getElementById("tri-interp-m1").addEventListener("mousemove", function(e) {
        var x = e.clientX - e.currentTarget.getBoundingClientRect().left;
        var y = e.clientY - e.currentTarget.getBoundingClientRect().top;

        update_with_naive(x, y);
      });

      update_with_naive(150, 150);
    });
  </script>
  <style type="text/css">
  .tri-int-div {
    width: 300px;
    height: 300px;
    margin-left: auto;
    margin-right: auto;
  }
  </style>
  <script>
  var plot_point = function(svg, x, y, color) {
    var k = document.createElementNS("http://www.w3.org/2000/svg", "rect");
    k.setAttribute("x", x);
    k.setAttribute("y", y);
    k.setAttribute("width", "1");
    k.setAttribute("height", "1");
    k.setAttribute("style", "fill: " + color);
    svg.appendChild(k);
  }

  var svg_save_link = function(svg) {
    var link = document.createElement("a");
    link.setAttribute('href-lang', 'image/svg+xml');
    link.setAttribute('href', 'data:image/svg+xml;utf8,' + unescape(svg.outerHTML));
    link.textContent = "Download";
    svg.parentNode.insertBefore(link, svg);

    window.prompt("Copy to clipboard: Ctrl+C, Enter", svg.outerHTML);
  }

  var int_color = function(c1, c2, c3, w1, w2, w3) {
    var r = (c1 >> 16) * w1 + (c2 >> 16) * w2 + (c3 >> 16) * w3;
    var g = ((c1 >> 8) & 0xFF) * w1 + ((c2 >> 8) & 0xFF) * w2 + ((c3 >> 8) & 0xFF) * w3;
    var b = (c1 & 0xFF) * w1 + (c2 & 0xFF) * w2 + (c3 & 0xFF) * w3;

    var c = Math.floor((b + (g << 8) + (r << 16)));
    return ("000000" + (c.toString(16))).slice(-6).toUpperCase()
  };

  var calc_naive_weights = function(x, y, v1x, v1y, v2x, v2y, v3x, v3y) {
    var d_v1 = Math.sqrt(Math.pow((x - v1x), 2) + Math.pow((y - v1y), 2));
    var d_v2 = Math.sqrt(Math.pow((x - v2x), 2) + Math.pow((y - v2y), 2));
    var d_v3 = Math.sqrt(Math.pow((x - v3x), 2) + Math.pow((y - v3y), 2));

    if (d_v1 == 0.0) {
      return [1, 0, 0];
    } else if (d_v2 == 0.0) {
      return [0, 1, 0];
    } else if (d_v3 == 0.0) {
      return [0, 0, 1];
    }

    var w_v1 = 1.0 / d_v1;
    var w_v2 = 1.0 / d_v2;
    var w_v3 = 1.0 / d_v3;

    var w_sum = w_v1 + w_v2 + w_v3;

    w_v1 /= w_sum;
    w_v2 /= w_sum;
    w_v3 /= w_sum;

    return [w_v1, w_v2, w_v3];
  }

  var calc_barycentric_weights = function(x, y, v1x, v1y, v2x, v2y, v3x, v3y) {
    var w_v1 = (x * (v3y - v2y) + v2x * (y - v3y) + v3x * (v2y - y)) / (v1x * (v3y - v2y) + v2x * (v1y - v3y) + v3x * (v2y - v1y));
    var w_v2 = -(x * (v3y - v1y) + v1x * (y - v3y) + v3x * (v1y - y)) / (v1x * (v3y - v2y) + v2x * (v1y - v3y) + v3x * (v2y - v1y));
    var w_v3 = 1.0 - w_v1 - w_v2;

    return [w_v1, w_v2, w_v3];
  }
  </script>
</head>

<body>
  <div id="frame">
    <div id="masthead">
      <div style="margin-top: -20px; float: right">
        <a href="https://0x7b1.github.io/home/">Home</a>
        <span class="sep">·</span>
        <a href="https://0x7b1.github.io/about/">About</a>
      </div>
      <div id="conftitle">Interpolating in a Triangle</div>
      Jul 22, 2018
      <span class="version">
        #cg
        <span class="sep">·</span>
        #math
      </span>
    </div>
    <div id="cover" style="font-size: 13px">
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="tri-int-div">
        <svg class="tri-interp-svg" width="300px" height="300px">
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="50" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="250" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="50" y1="250" x2="250" y2="250"></line>
          <circle style="stroke: #718093; stroke-width: 3; fill: black;" cx="150" cy="50" r="5"></circle>
          <circle style="stroke: #718093; stroke-width: 3; fill: black;" cx="50" cy="250" r="5"></circle>
          <circle style="stroke: #718093; stroke-width: 3; fill: black;" cx="250" cy="250" r="5"></circle><text style="fill: #718093; font-size: 15px;" x="165" y="50">V<tspan style="font-size: 15px;">1</tspan></text><text style="fill: #718093; font-size: 15px;" x="10" y="250">V<tspan style="font-size: 15px;">2</tspan></text><text style="fill: #718093; font-size: 15px;" x="265" y="250">V<tspan style="font-size: 15px;">3</tspan></text>
        </svg></div>
      <p style="text-align: center;">Figure 1</p>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="tri-int-div">
        <svg class="tri-interp-svg" width="300px" height="300px">
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="50" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="250" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="50" y1="250" x2="250" y2="250"></line>
          <circle style="stroke: #EA2027; stroke-width: 3; fill: black;" cx="150" cy="50" r="5"></circle>
          <circle style="stroke: #C4E538; stroke-width: 3; fill: black;" cx="50" cy="250" r="5"></circle>
          <circle style="stroke: #D980FA; stroke-width: 3; fill: black;" cx="250" cy="250" r="5"></circle><text style="fill: #718093; font-size: 15px;" x="165" y="50">V<tspan style="font-size: 15px;">1</tspan></text><text style="fill: #718093; font-size: 15px;" x="10" y="250">V<tspan style="font-size: 15px;">2</tspan></text><text style="fill: #718093; font-size: 15px;" x="265" y="250">V<tspan style="font-size: 15px;">3</tspan></text>
          <circle style="stroke: #718093; stroke-width: 2; fill: black;" cx="130" cy="150" r="5"></circle><text style="fill: #718093; font-size: 15px;" x="140" y="150">P</text>
        </svg></div>
      <p style="text-align: center;">Figure 2</p>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div id="tri-interp-m1" class="tri-int-div">
        <svg class="tri-interp-svg" width="300px" height="300px">
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="50" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="250" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="50" y1="250" x2="250" y2="250"></line>
          <line id="tri-interp-m1-l1" style="stroke: grey; stroke-width: 1" x1="150" y1="50" x2="150" y2="150"></line>
          <line id="tri-interp-m1-l2" style="stroke: grey; stroke-width: 1" x1="50" y1="250" x2="150" y2="150"></line>
          <line id="tri-interp-m1-l3" style="stroke: grey; stroke-width: 1" x1="250" y1="250" x2="150" y2="150"></line>
          <circle style="stroke: #EA2027; stroke-width: 3; fill: black;" cx="150" cy="50" r="5"></circle>
          <circle style="stroke: #C4E538; stroke-width: 3; fill: black;" cx="50" cy="250" r="5"></circle>
          <circle style="stroke: #D980FA; stroke-width: 3; fill: black;" cx="250" cy="250" r="5"></circle><text style="fill: #718093; font-size: 15px;" x="165" y="60">V<tspan style="font-size: 15px;">1</tspan></text><text style="fill: #718093; font-size: 15px;" x="10" y="250">V<tspan style="font-size: 15px;">2</tspan></text><text style="fill: #718093; font-size: 15px;" x="265" y="250">V<tspan style="font-size: 15px;">3</tspan></text><text id="tri-interp-m1-w1" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="150" y="30"></text><text id="tri-interp-m1-w2" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="50" y="280"></text><text id="tri-interp-m1-w3" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="250" y="280"></text>
          <circle id="tri-interp-m1-p" style="stroke: #718093; stroke-width: 2; fill: black;" cx="150" cy="150" r="5"></circle>
        </svg></div>
      <p style="text-align: center;">Figure 3</p>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div id="tri-interp-m2" class="tri-int-div">
        <svg class="tri-interp-svg" width="300px" height="300px">
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="50" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="150" y1="50" x2="250" y2="250"></line>
          <line style="stroke: #718093; stroke-width: 3" x1="50" y1="250" x2="250" y2="250"></line>
          <line id="tri-interp-m2-l1" style="stroke: grey; stroke-width: 1" x1="150" y1="50" x2="150" y2="150"></line>
          <line id="tri-interp-m2-l2" style="stroke: grey; stroke-width: 1" x1="50" y1="250" x2="150" y2="150"></line>
          <line id="tri-interp-m2-l3" style="stroke: grey; stroke-width: 1" x1="250" y1="250" x2="150" y2="150"></line>
          <circle style="stroke: #EA2027; stroke-width: 3; fill: black;" cx="150" cy="50" r="5"></circle>
          <circle style="stroke: #C4E538; stroke-width: 3; fill: black;" cx="50" cy="250" r="5"></circle>
          <circle style="stroke: #D980FA; stroke-width: 3; fill: black;" cx="250" cy="250" r="5"></circle><text style="fill: #718093; font-size: 15px;" x="165" y="60">V<tspan style="font-size: 15px;">1</tspan></text><text style="fill: #718093; font-size: 15px;" x="10" y="250">V<tspan style="font-size: 15px;">2</tspan></text><text style="fill: #718093; font-size: 15px;" x="265" y="250">V<tspan style="font-size: 15px;">3</tspan></text><text id="tri-interp-m2-w1" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="150" y="30"></text><text id="tri-interp-m2-w2" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="50" y="280"></text><text id="tri-interp-m2-w3" style="text-anchor: middle; fill: #718093; font-size: 15px;" x="250" y="280"></text>
          <circle id="tri-interp-m2-p" style="stroke: #718093; stroke-width: 2; fill: black;" cx="150" cy="150" r="5"></circle>
        </svg></div>
      <p style="text-align: center;">Figure 4</p>
      <br>
      <br>
      <br>
      <br>
    </div>
    <div id="copy">
      <p>Let's say we have a triangle. Maybe something like the Figure 1.</p>
      <p>Furthermore, let's say that each vertex (corner) has an associated value of some sort. For example: assume each vertex has an associated color. Perhaps we have:</p>
      <ul>
        <li>Vertex 1 is red</li>
        <li>Vertex 2 is green</li>
        <li>Vertex 3 is purple</li>
      </ul>
      <p>Given an arbitrary point \(P\), inside of the triangle, how do we define its color? (Refer to Figure 2)</p>
      <pre>
        <code class="cpp" style="font-size: 13px">
const plot_point = function(svg, x, y, color) {
  const k = document.createElementNS("http://www.w3.org/2000/svg", 
    "rect");
  k.setAttribute("x", x);
  k.setAttribute("y", y);
  k.setAttribute("width", "1");
  k.setAttribute("height", "1");
  k.setAttribute("style", "fill: " + color);
  svg.appendChild(k);
}

const svg_save_link = function(svg) {
  const link = document.createElement("a");
  link.setAttribute('href-lang', 'image/svg+xml');
  link.setAttribute('href', 'data:image/svg+xml;utf8,' + 
    unescape(svg.outerHTML));
  link.textContent = "Download";
  svg.parentNode.insertBefore(link, svg);

  window.prompt("Copy to clipboard: Ctrl+C, Enter", svg.outerHTML);
}
        </code>
      </pre>
      <p>We're using color as only an example. We may actually want to interpolate over any attribute associated at the vertexes. e.g. U/V texture coordinates, Z-buffer depth, normal values.</p>
      <p>If you played the video game SimAnt before, you may remember the behavior control using a triangle to balance a ratio of three actions: forage, dig, and nurse.</p>
      <pre>
        <code class="cpp" style="font-size: 13px">
function int_color(c1, c2, c3, w1, w2, w3) {
  const r = (c1 >> 16) * w1 + 
            (c2 >> 16) * w2 + 
            (c3 >> 16) * w3;
  const g = ((c1 >> 8) & 0xFF) * w1 + 
            ((c2 >> 8) & 0xFF) * w2 + 
            ((c3 >> 8) & 0xFF) * w3;
  const b = (c1 & 0xFF) * w1 + 
            (c2 & 0xFF) * w2 + 
            (c3 & 0xFF) * w3;

  const c = Math.floor((b + (g << 8) + (r << 16)));

  return ("000000" + (c.toString(16))).slice(-6).toUpperCase()
};
        </code>
      </pre>
      <h1>The Lazy Approach</h1>
      <p>We could simply say that P is closest to V1, and therefore make P #EA2027. If we do this for every point in the triangle, we get this: </p>
      <p>This is called the Nearest-Neighbor method, and it gives us something call a Voronoi diagram. In any case, it's not what we're looking for.</p>
      <br>
      <h1>The Naive Solution</h1>
      <p>I'd like to work through one other false start before giving the final answer. I find that when the solution is a bit complicated, it's nice to first justify why a simpler approach won't work.</p>
      <p>So a point in the triangle should take some value from all three of the vertices. We know that it should take more value from vertices that it's closer to, and less value from ones that it's farther away from. In our earlier example, we can see that our query point, P, is fairly close to V1 and V2. It's a good deal farther from V3. So it makes sense to think that we should color it more #EA2027 and #C4E538 and less #D980FA.</p>
      <p>We can figure the distance from P to each vertex by using the Pythagorean theorem.</p>
      <span>
        \[
        Distance_{v1} = \sqrt{(X_{v1} - P_{x})^2 + (Y_{v1} - P_{y})^2}
        \]
        \[
        Distance_{v2} = \sqrt{(X_{v2} - P_{x})^2 + (Y_{v2} - P_{y})^2}
        \]
        \[
        Distance_{v3} = \sqrt{(X_{v3} - P_{x})^2 + (Y_{v3} - P_{y})^2}
        \]
      </span>
      <br>
      <p>Distances give us big numbers when we are far away, and small numbers when we're close. So we might try inverting them so that bigger numbers give more weight to closer verticies. In other words, we'll interpolate inversely proportional to the distance to each vertex.</p>
      <p>So we could define our weights as:</p>
      <span>
        \[
        W_{v1} = \frac{1}{Distance_{v1}}
        \]
        \[
        W_{v2} = \frac{1}{Distance_{v2}}
        \]
        \[
        W_{v3} = \frac{1}{Distance_{v3}}
        \]
      </span>
      <br>
      <p>Now we can define our color as a weighted average:</p>
      <br>
      <span>
        \[
        Color_{p} = \frac{W_{v1} Color_{v1} + W_{v2} Color_{v2} + W_{v3} Color_{v3}}
        {W_{v1} + W_{v2} + W_{v3}}
        \]
      </span>
      <br>
      <p>This has the nice property that a vertex twice as far away only contributes half as much to the solution. This techinque is useful in many other fields too. For example, in machine learing it is common to normalize a distance metric by taking its inverse.</p>
      <p>So in summary, we are finding an interpolated color at point P by blending the vertex colors in porportion to how close they are to P.</p>
      <p>You can mouse around in this demo (Figure 3) to see how the weight values change inside the triangle with this method.</p>
      <pre>
        <code class="cpp" style="font-size: 13px">
function calc_barycentric_weights(x, y, v1x, v1y, v2x, v2y, v3x, v3y) {
  const w_v1 = (x * (v3y - v2y) + v2x * (y - v3y) + v3x * (v2y - y)) / 
    (v1x * (v3y - v2y) + v2x * (v1y - v3y) + v3x * (v2y - v1y));
  const w_v2 = -(x * (v3y - v1y) + v1x * (y - v3y) + v3x * (v1y - y)) / 
    (v1x * (v3y - v2y) + v2x * (v1y - v3y) + v3x * (v2y - v1y));
  const w_v3 = 1.0 - w_v1 - w_v2;

  return [w_v1, w_v2, w_v3];
}
        </code>
      </pre>
      <p>Using this method for color interpolation over the entire triangle yields:</p>
      <p>Doesn't look too bad, eh? This solution is simple, easy to implement, and fairly intuitive. It would probably work fine in many applications. However, if we shift the triangle a bit, we see the major problem with this approach.</p>
      <p>Look at point P in the example above. It lies directly on the straight line between V1 and V3. For most interpolation problems, we would actually like the value at P to be a combination solely of V1 and V3. We would usually ignore V2 completely at point P. With our naive solution, however, we've really messed up! Since point P is closest to V2, P ends up taking most of its value from V2!</p>
      <p>If this doesn't seem like a big deal, just think of how you would use interpolated data on a triangle. For example, if you were interpolating a Z-buffer coordinate, you would expect any point on the line between V1 and V3 to use only the Z coordinates of V1 and V3. If it used any of V2, then it wouldn't be a straight line!</p>
      <p>Take another look at SimAnt. If we set the cursor exactly between forage and dig, we see that the nurse weight is 0. So SimAnt has a better method than our naive inverse weighted distance method.</p>
      <p>Let's try another approach.</p>
      <br>
      <h1>Barycentric Coordinates</h1>
      <p>The real solution to our problem is Barycentric Coordinates. The concept can be a bit subtle to grasp at first, but it's not complicated, and it will make sense with just a bit of pondering.</p>
      <p>The trick to Barycentric Coordinates is to find the weights for V1, V2, and V3 that balance the following system of equations:</p>
      <br>
      <span>
        \[
        P_{x} = W_{v1} X_{v1} + W_{v2} X_{v2} + W_{v3} X_{v3}
        \]
        \[
        P_{y} = W_{v1} Y_{v1} + W_{v2} Y_{v2} + W_{v3} Y_{v3}
        \]
        \[
        W_{v1} + W_{v2} + W_{v3} = 1
        \]
      </span>
      <br>
      <p>Think about what those equations mean for a minute. What we're really asking for is self-consistancy. If we want to interpolate color or Z-buffer values, we're asking for weights that would also work for the X and Y coordinates themselves in the same consistant manner! In other words, for a given point P, we're finding weights that tell us how much of P's X coordinate is made of V1, V2, and V3, and also the same for P's Y coordinate.</p>
      <p>With a lot of rearranging, we can solve for W1, W2, and W3 for any given point with the following equations:</p>
      <br>
      <span>
        \[
        W_{v1}=\frac{(Y_{v2}-Y_{v3})(P_{x}-X_{v3})+(X_{v3}-X_{v2})(P_{y}-Y_{v3})}{(Y_{v2}-Y_{v3})(X_{v1}-X_{v3})+(X_{v3}-X_{v2})(Y_{v1}-Y_{v3})}
        \]
        \[
        W_{v2}=\frac{(Y_{v3}-Y_{v1})(P_{x}-X_{v3})+(X_{v1}-X_{v3})(P_{y}-Y_{v3})}{(Y_{v2}-Y_{v3})(X_{v1}-X_{v3})+(X_{v3}-X_{v2})(Y_{v1}-Y_{v3})}
        \]
        \[
        W_{v3}=1 - W_{v1} - W_{v2}
        \]
      </span>
      <br>
      <p>Note that the denominators are the same for W1 and W2, and also that W3 is calculated by the fact that all of the weights sum to 1.</p>
      <p>You can mouse around in this demo (Figure 4) to see how the weight values change inside the triangle.</p>
      <p>Another thing about barycentric coordinates, is that if P is actually outside of the triangle, then at least one of W1, W2, or W3 will be negative! This can be used as an easy check to see if a point lies inside or outside of a triangle.</p>
      <p>In fact, a common triangle drawing algorithm is to look at every pixel in a bounding box around the triangle. Then for each pixel, calculate the barycentric coordinates (which are needed anyway to interpolate the depth buffer, texture coordinates, etc). If one of the weights is a negative number, then the pixel is simply skipped. One advantage of this algorithm is that a graphics card can simply parallelize every pixel in the bounding box. This allows drawing triangles to be very fast.</p>
      <p>Here's what the final color interpolation from our original question looks like if we use a barycentric coordinate system.</p>
      <p>I hope you found that build-up and explanation to barycentric coordinates interesting. Let me know what you think by leaving a comment below.</p>
    </div>
    <footer class="footer">
      <div class="container container--large">
        © 2020 Juan Carlos Ramos
      </div>
    </footer>
    <br>
    <br>
  </div>
</body>

</html>